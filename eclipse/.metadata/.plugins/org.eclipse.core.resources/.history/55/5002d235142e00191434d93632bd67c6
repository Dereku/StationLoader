package net.rek.oldmainmenu.eventlisteners;

import java.util.Random;

import org.lwjgl.opengl.GL11;
import org.lwjgl.util.glu.GLU;

import net.minecraft.client.Minecraft;
import net.minecraft.src.Block;
import net.minecraft.src.GuiMainMenu;
import net.minecraft.src.ScaledResolution;
import net.modificationstation.stationloader.common.util.ReflectionHelper;
import net.modificationstation.stationloader.common.util.SubscribeEvent;
import net.rek.oldmainmenu.util.LogoEffectRandomizer;
import net.rek.oldmainmenu.util.RenderBlocksLogoFunc;

public class GuiMainMenuListener {
    @SubscribeEvent
    public static void drawScreen(MCGuiScreenDrawScreenEvent event) {
        if (event.getGuiScreen() instanceof GuiMainMenu)
            drawLogo(event.getPartialTicks(), event);
    }
    private static void drawLogo(float f, MCGuiMainMenuDrawScreenEvent event)
    {
        if(logoEffects == null)
        {
            logoEffects = new LogoEffectRandomizer[getLogoWidth()][minecraftLogo.length];
            for(int i = 0; i < logoEffects.length; i++)
            {
                for(int j = 0; j < logoEffects[i].length; j++)
                {
                    logoEffects[i][j] = new LogoEffectRandomizer((GuiMainMenu)event.getGuiScreen(), i, j);
                }

            }

        }
        GL11.glMatrixMode(5889 /*GL_PROJECTION*/);
        GL11.glPushMatrix();
        GL11.glLoadIdentity();
        ScaledResolution scaledresolution = new ScaledResolution(mc.gameSettings, mc.displayWidth, mc.displayHeight);
        int k = 120 * scaledresolution.scaleFactor;
        GLU.gluPerspective(70F, (float)mc.displayWidth / (float)k, 0.05F, 100F);
        GL11.glViewport(0, mc.displayHeight - k, mc.displayWidth, k);
        GL11.glMatrixMode(5888 /*GL_MODELVIEW0_ARB*/);
        GL11.glPushMatrix();
        GL11.glLoadIdentity();
        GL11.glDisable(2884 /*GL_CULL_FACE*/);
        GL11.glCullFace(1029 /*GL_BACK*/);
        GL11.glDepthMask(true);
        RenderBlocksLogoFunc renderblockslogofunc = new RenderBlocksLogoFunc();
        for(int l = 0; l < 3; l++)
        {
            GL11.glPushMatrix();
            GL11.glTranslatef(0.4F, 0.6F, -13F);
            if(l == 0)
            {
                GL11.glClear(256);
                GL11.glTranslatef(0.0F, -0.4F, 0.0F);
                GL11.glScalef(0.98F, 1.0F, 1.0F);
                GL11.glEnable(3042 /*GL_BLEND*/);
                GL11.glBlendFunc(770, 771);
            }
            if(l == 1)
            {
                GL11.glDisable(3042 /*GL_BLEND*/);
                GL11.glClear(256);
            }
            if(l == 2)
            {
                GL11.glEnable(3042 /*GL_BLEND*/);
                GL11.glBlendFunc(768, 1);
            }
            GL11.glScalef(1.0F, -1F, 1.0F);
            GL11.glRotatef(15F, 1.0F, 0.0F, 0.0F);
            GL11.glScalef(0.89F, 1.0F, 0.4F);
            GL11.glTranslatef((float)(-getLogoWidth()) * 0.5F, (float)(-minecraftLogo.length) * 0.5F, 0.0F);
            GL11.glBindTexture(3553 /*GL_TEXTURE_2D*/, mc.renderEngine.getTexture("/terrain.png"));
            if(l == 0)
            {
                GL11.glBindTexture(3553 /*GL_TEXTURE_2D*/, mc.renderEngine.getTexture("/title/black.png"));
            }
            for(int i1 = 0; i1 < minecraftLogo.length; i1++)
            {
                for(int j1 = 0; j1 < minecraftLogo[i1].length(); j1++)
                {
                    char c = minecraftLogo[i1].charAt(j1);
                    if(c == ' ')
                    {
                        continue;
                    }
                    GL11.glPushMatrix();
                    LogoEffectRandomizer logoeffectrandomizer = logoEffects[j1][i1];
                    float f1 = (float)(logoeffectrandomizer.field_1311_b + (logoeffectrandomizer.field_1312_a - logoeffectrandomizer.field_1311_b) * (double)f);
                    float f2 = 1.0F;
                    float f3 = 1.0F;
                    float f4 = 0.0F;
                    if(l == 0)
                    {
                        f2 = f1 * 0.04F + 1.0F;
                        f3 = 1.0F / f2;
                        f1 = 0.0F;
                    }
                    GL11.glTranslatef(j1, i1, f1);
                    GL11.glScalef(f2, f2, f2);
                    GL11.glRotatef(f4, 0.0F, 1.0F, 0.0F);
                    /*if (mod_oldCustomLogo.getBlock(i1, j1) != null) 
                    {
                        renderblockslogofunc.func_1238_a(mod_oldCustomLogo.getBlock(i1, j1), mod_oldCustomLogo.getMetaData(i1, j1), f3);
                    }
                    else 
                    {*/
                        renderblockslogofunc.func_1238_a(Block.stone, 0, f3);
                    //}
                    GL11.glPopMatrix();
                }

            }

            GL11.glPopMatrix();
        }

        GL11.glDisable(3042 /*GL_BLEND*/);
        GL11.glMatrixMode(5889 /*GL_PROJECTION*/);
        GL11.glPopMatrix();
        GL11.glMatrixMode(5888 /*GL_MODELVIEW0_ARB*/);
        GL11.glPopMatrix();
        GL11.glViewport(0, 0, mc.displayWidth, mc.displayHeight);
        GL11.glEnable(2884 /*GL_CULL_FACE*/);
    }
    
    private static int getLogoWidth() {
        return minecraftLogo[0].length();
    }
    public static Random getRand() {
        return (Random)ReflectionHelper.getPrivateValue(GuiMainMenu.class, null, 0);
    }
    static String minecraftLogo[] = new String[] {
            "X   X X X   X XXX XXX XXX XXX XXX XXX",
            "XX XX X XX  X X   X   X X X X X    X ",
            "X X X X X X X XX  X   XX  XXX XX   X ",
            "X   X X X  XX X   X   X X X X X    X ",
            "X   X X X   X XXX XXX X X X X X    X "
    };
    private static LogoEffectRandomizer logoEffects[][];
    public static Minecraft mc = Minecraft.theMinecraft;
}
